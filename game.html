<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falling Ball Game</title>
    <style>
        canvas {
            border: 1px solid black;
        }
        #startButton, #restartButton {
            font-size: 20px;
            padding: 10px 20px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <br>
    <button id="startButton">Start Game</button>
    <button id="restartButton" style="display: none;">Restart Game</button>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');

        const BALL_Y = canvas.height / 3;  // Fixed vertical position for the ball

        let ball = {
            x: canvas.width / 2,
            y: BALL_Y,
            radius: 10,
            color: 'blue',
            velocity: { x: 0, y: 0 },
        };

        let floors = [];
        let gameOver = false;
        let score = 0;
        let scrollSpeed = 1;
        let clickedOnBall = false;
        let inflationRate = 0.2;
        let gameStarted = false;
        let timeSinceStart = 0;

        function init() {
            resetGame();
            canvas.addEventListener('mousedown', onMouseDown);
            canvas.addEventListener('mousemove', onMouseMove);
            canvas.addEventListener('mouseup', onMouseUp);
            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', restartGame);
            gameLoop();
        }

        function resetGame() {
            ball = {
                x: canvas.width / 2,
                y: BALL_Y,
                radius: 10,
                color: 'blue',
                velocity: { x: 0, y: 0 },
            };
            floors = [];
            gameOver = false;
            score = 0;
            scrollSpeed = 1;
            gameStarted = false;
            timeSinceStart = 0;
        }

        function startGame() {
            gameStarted = true;
            startButton.style.display = 'none';
            restartButton.style.display = 'none';
        }

        function restartGame() {
            resetGame();
            startGame();
        }

        function createFloor() {
            floors.push({
                y: canvas.height,
                openingStart: Math.random() * (canvas.width - 80),
                openingWidth: 80 + Math.random() * (60 - score)
            });
        }

        function onMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            if (Math.sqrt((mouseX - ball.x) ** 2 + (mouseY - ball.y) ** 2) <= ball.radius) {
                clickedOnBall = true;
            }
        }

        function onMouseMove(e) {
            if (clickedOnBall) {
                const rect = canvas.getBoundingClientRect();
                ball.x = e.clientX - rect.left;
                ball.radius += inflationRate;
            }
        }

        function onMouseUp(e) {
            if (clickedOnBall) {
                clickedOnBall = false;
                const rect = canvas.getBoundingClientRect();
                ball.velocity.x = (e.clientX - rect.left - ball.x) / 20;
            }
        }

        function update() {
            if (gameStarted && !gameOver) {
                timeSinceStart += 1/60;  // Assuming 60 FPS

                if (!clickedOnBall) {
                    ball.x += ball.velocity.x;
                    ball.velocity.x *= 0.98;  // Apply friction

                    // Keep ball within canvas
                    if (ball.x - ball.radius < 0 || ball.x + ball.radius > canvas.width) {
                        ball.velocity.x *= -1;
                    }
                }

                // Move floors up
                floors.forEach(floor => floor.y -= scrollSpeed);

                // Check collision with floors
                floors.forEach(floor => {
                    if (Math.abs(ball.y - floor.y) < ball.radius) {
                        if (ball.x < floor.openingStart || ball.x > floor.openingStart + floor.openingWidth) {
                            gameOver = true;
                            ball.color = 'red';
                            restartButton.style.display = 'inline-block';
                        } else {
                            score++;
                        }
                    }
                });

                // Remove off-screen floors and create new ones
                floors = floors.filter(floor => floor.y > 0);
                if (floors.length === 0 || floors[floors.length - 1].y < canvas.height - 150) {
                    createFloor();
                }

                // Increase difficulty
                scrollSpeed += 0.001;

                // Deflate ball
                if (ball.radius > 10 && !clickedOnBall) {
                    ball.radius -= inflationRate / 2;
                }

                // Create first floor after 2 seconds
                if (timeSinceStart > 2 && floors.length === 0) {
                    createFloor();
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw floors
            ctx.fillStyle = 'gray';
            floors.forEach(floor => {
                ctx.fillRect(0, floor.y, floor.openingStart, 10);
                ctx.fillRect(floor.openingStart + floor.openingWidth, floor.y, canvas.width - floor.openingStart - floor.openingWidth, 10);
            });

            // Draw ball
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = ball.color;
            ctx.fill();
            ctx.closePath();

            // Draw face
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(ball.x - ball.radius / 3, ball.y - ball.radius / 3, ball.radius / 5, 0, Math.PI * 2);
            ctx.arc(ball.x + ball.radius / 3, ball.y - ball.radius / 3, ball.radius / 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(ball.x, ball.y + ball.radius / 3, ball.radius / 3, 0, Math.PI, false);
            ctx.stroke();

            // Draw score
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);

            if (gameOver) {
                ctx.fillStyle = 'black';
                ctx.font = '40px Arial';
                ctx.fillText('Game Over!', canvas.width / 2 - 100, canvas.height / 2);
            }

            if (!gameStarted) {
                ctx.fillStyle = 'black';
                ctx.font = '30px Arial';
                ctx.fillText('Click Start to begin!', canvas.width / 2 - 120, canvas.height / 2);
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        init();
    </script>
</body>
</html>
